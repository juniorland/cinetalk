<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CineTalk - Assistente de cinema por voz especializado em filmes e sÃ©ries">
    <meta name="theme-color" content="#1a1a2e">
    <title>CineTalk - Assistente de Cinema por Voz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 15px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 25px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #e94560, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1em;
        }

        .config-panel {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .api-setup {
            margin-bottom: 20px;
        }

        .api-setup label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ff6b9d;
        }

        .api-setup input {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 1em;
            transition: all 0.3s;
        }

        .api-setup input:focus {
            outline: none;
            border-color: #e94560;
            background: rgba(255, 255, 255, 0.08);
        }

        .api-setup small {
            color: #aaa;
            display: block;
            margin-top: 8px;
            font-size: 0.9em;
        }

        .api-setup small a {
            color: #ff6b9d;
            text-decoration: none;
            font-weight: 600;
        }

        .api-setup small a:hover {
            text-decoration: underline;
        }

        .language-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .language-selector button {
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1em;
        }

        .language-selector button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .language-selector button.active {
            background: linear-gradient(135deg, #e94560 0%, #ff6b9d 100%);
            border-color: #e94560;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message {
            margin-bottom: 15px;
            padding: 16px 18px;
            border-radius: 12px;
            animation: fadeIn 0.4s ease;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-left: 15%;
            border-bottom-right-radius: 4px;
        }

        .message.assistant {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-right: 15%;
            border-bottom-left-radius: 4px;
        }

        .message.system {
            background: rgba(255, 255, 255, 0.1);
            text-align: center;
            font-style: italic;
            color: #bbb;
            margin: 10px 0;
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .voice-button {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 2.2em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .voice-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: scale(0.95);
        }

        .voice-button:active:not(:disabled) {
            transform: scale(0.95);
        }

        .record-btn {
            background: linear-gradient(135deg, #e94560 0%, #ff6b9d 100%);
            color: white;
        }

        .record-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(233, 69, 96, 0.5);
        }

        .record-btn.recording {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 5px 25px rgba(255, 0, 0, 0.4);
            }
            50% { 
                transform: scale(1.08); 
                box-shadow: 0 8px 35px rgba(255, 0, 0, 0.6);
            }
        }

        .stop-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stop-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        .status {
            text-align: center;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .status.recording {
            background: rgba(255, 0, 0, 0.15);
            border-color: #ff4444;
            animation: statusPulse 2s infinite;
        }

        .status.processing {
            background: rgba(255, 165, 0, 0.15);
            border-color: #ffa500;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .suggestions {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .suggestions h3 {
            color: #ff6b9d;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 12px 16px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(8px);
            border-color: #e94560;
        }

        .info-box {
            background: rgba(100, 150, 255, 0.15);
            border-left: 4px solid #6496ff;
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .info-box strong {
            color: #6496ff;
            display: block;
            margin-bottom: 10px;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #e94560 0%, #ff6b9d 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff6b9d 0%, #e94560 100%);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .message.user {
                margin-left: 10%;
            }

            .message.assistant {
                margin-right: 10%;
            }

            .voice-button {
                width: 75px;
                height: 75px;
                font-size: 2em;
            }

            .language-selector {
                grid-template-columns: 1fr;
            }
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ð¬ CineTalk</h1>
            <p class="subtitle">Seu assistente de cinema por voz especializado em filmes e sÃ©ries de todas as Ã©pocas</p>
        </header>

        <div class="config-panel">
            <div class="api-setup">
                <label for="apiKey">ð Chave da API OpenAI:</label>
                <input type="password" id="apiKey" placeholder="sk-proj-..." autocomplete="off">
                <small>
                    Obtenha sua chave gratuitamente em: <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">platform.openai.com/api-keys</a>
                </small>
            </div>

            <label style="color: #ff6b9d; font-weight: 600; margin-bottom: 10px; display: block;">
                ð Idioma de ConversaÃ§Ã£o:
            </label>
            <div class="language-selector">
                <button class="lang-btn active" data-lang="pt-BR">ð§ð· PortuguÃªs</button>
                <button class="lang-btn" data-lang="en-US">ðºð¸ English</button>
                <button class="lang-btn" data-lang="es-ES">ðªð¸ EspaÃ±ol</button>
            </div>
        </div>

        <div class="status" id="status">
            ð¬ Pronto para conversar! Configure sua API Key e clique no microfone para comeÃ§ar.
        </div>

        <div class="chat-container" id="chatContainer"></div>

        <div class="controls">
            <button class="voice-button record-btn" id="recordBtn" title="Iniciar gravaÃ§Ã£o de voz">
                ð¤
            </button>
            <button class="voice-button stop-btn" id="stopBtn" disabled title="Parar reproduÃ§Ã£o de Ã¡udio">
                ð
            </button>
        </div>

        <div class="suggestions">
            <h3>ð¡ SugestÃµes de Conversa:</h3>
            <div class="suggestion-item" data-text="Me recomende filmes de ficÃ§Ã£o cientÃ­fica dos anos 80">
                ð Filmes de ficÃ§Ã£o cientÃ­fica dos anos 80
            </div>
            <div class="suggestion-item" data-text="Quais sÃ£o as melhores sÃ©ries de suspense da Netflix?">
                ð Melhores sÃ©ries de suspense da Netflix
            </div>
            <div class="suggestion-item" data-text="Conte-me sobre os filmes do Quentin Tarantino">
                ð¬ Filmes de Quentin Tarantino
            </div>
            <div class="suggestion-item" data-text="Que sÃ©ries sÃ£o boas para assistir em famÃ­lia?">
                ð¨âð©âð§âð¦ SÃ©ries para toda a famÃ­lia
            </div>
            <div class="suggestion-item" data-text="Qual Ã© a histÃ³ria do cinema noir?">
                ðµï¸ HistÃ³ria do cinema noir
            </div>
            <div class="suggestion-item" data-text="Recomende filmes de animaÃ§Ã£o premiados">
                ð¨ AnimaÃ§Ãµes premiadas
            </div>
        </div>

        <div class="info-box">
            <strong>â¹ï¸ Como usar o CineTalk:</strong>
            Primeiro, insira sua chave da API OpenAI no campo acima. Em seguida, escolha o idioma desejado para a conversaÃ§Ã£o. Clique no botÃ£o do microfone e fale naturalmente sobre qualquer tema relacionado a cinema, incluindo filmes clÃ¡ssicos, lanÃ§amentos recentes, sÃ©ries de streaming, diretores, atores ou solicite recomendaÃ§Ãµes personalizadas. O assistente responderÃ¡ por voz com informaÃ§Ãµes detalhadas e sugestÃµes adequadas ao seu gosto.
        </div>
    </div>

    <script>
        let apiKey = '';
        let currentLanguage = 'pt-BR';
        let mediaRecorder = null;
        let audioChunks = [];
        let currentAudio = null;
        let conversationHistory = [];
        let isRecording = false;

        const chatContainer = document.getElementById('chatContainer');
        const statusDiv = document.getElementById('status');
        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const apiKeyInput = document.getElementById('apiKey');

        const systemPrompts = {
            'pt-BR': `VocÃª Ã© CineTalk, um assistente especializado em cinema, filmes e sÃ©ries de streaming. VocÃª possui conhecimento profundo e atualizado sobre a sÃ©tima arte, incluindo filmes de todas as Ã©pocas desde os primÃ³rdios do cinema mudo atÃ© os lanÃ§amentos mais recentes. Seu conhecimento abrange sÃ©ries de plataformas como Netflix, Prime Video, Disney Plus, HBO Max, Apple TV Plus, Paramount Plus e outras. Suas Ã¡reas de expertise incluem histÃ³ria do cinema, movimentos cinematogrÃ¡ficos, diretores renomados e emergentes, atores e atrizes, gÃªneros cinematogrÃ¡ficos variados, anÃ¡lise de roteiro e cinematografia, curiosidades e bastidores de produÃ§Ãµes, alÃ©m de recomendaÃ§Ãµes personalizadas para diferentes pÃºblicos e faixas etÃ¡rias. Mantenha suas respostas conversacionais, entusiasmadas e acessÃ­veis. ForneÃ§a recomendaÃ§Ãµes personalizadas baseadas nas preferÃªncias demonstradas pelo usuÃ¡rio. Seja conciso porÃ©m informativo, ideal para conversas por voz. Adapte seu vocabulÃ¡rio ao nÃ­vel de conhecimento cinematogrÃ¡fico demonstrado pelo usuÃ¡rio, desde iniciantes atÃ© cinÃ©filos experientes.`,
            
            'en-US': `You are CineTalk, an assistant specialized in cinema, movies and streaming series. You possess deep and updated knowledge about the seventh art, including films from all eras from the early days of silent cinema to the most recent releases. Your knowledge covers series from platforms such as Netflix, Prime Video, Disney Plus, HBO Max, Apple TV Plus, Paramount Plus and others. Your areas of expertise include film history, cinematographic movements, renowned and emerging directors, actors and actresses, varied film genres, screenplay and cinematography analysis, trivia and behind-the-scenes of productions, as well as personalized recommendations for different audiences and age groups. Keep your responses conversational, enthusiastic and accessible. Provide personalized recommendations based on the preferences shown by the user. Be concise yet informative, ideal for voice conversations. Adapt your vocabulary to the level of film knowledge demonstrated by the user, from beginners to experienced cinephiles.`,
            
            'es-ES': `Eres CineTalk, un asistente especializado en cine, pelÃ­culas y series de streaming. Posees conocimiento profundo y actualizado sobre el sÃ©ptimo arte, incluyendo pelÃ­culas de todas las Ã©pocas desde los inicios del cine mudo hasta los estrenos mÃ¡s recientes. Tu conocimiento abarca series de plataformas como Netflix, Prime Video, Disney Plus, HBO Max, Apple TV Plus, Paramount Plus y otras. Tus Ã¡reas de experiencia incluyen historia del cine, movimientos cinematogrÃ¡ficos, directores reconocidos y emergentes, actores y actrices, gÃ©neros cinematogrÃ¡ficos variados, anÃ¡lisis de guion y cinematografÃ­a, curiosidades y tras cÃ¡maras de producciones, ademÃ¡s de recomendaciones personalizadas para diferentes pÃºblicos y grupos de edad. MantÃ©n tus respuestas conversacionales, entusiastas y accesibles. Proporciona recomendaciones personalizadas basadas en las preferencias mostradas por el usuario. SÃ© conciso pero informativo, ideal para conversaciones por voz. Adapta tu vocabulario al nivel de conocimiento cinematogrÃ¡fico demostrado por el usuario, desde principiantes hasta cinÃ©filos experimentados.`
        };

        window.addEventListener('load', () => {
            const savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
                apiKey = savedApiKey;
                addMessage('system', 'â API Key carregada automaticamente');
            }
        });

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentLanguage = btn.dataset.lang;
                const languageNames = {'pt-BR': 'PortuguÃªs (Brasil)', 'en-US': 'English (United States)', 'es-ES': 'EspaÃ±ol (EspaÃ±a)'};
                addMessage('system', `Idioma alterado para: ${languageNames[currentLanguage]}`);
            });
        });

        apiKeyInput.addEventListener('change', (e) => {
            apiKey = e.target.value.trim();
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
                addMessage('system', 'â API Key configurada e salva com sucesso');
                statusDiv.textContent = 'ð¬ Pronto para conversar! Clique no microfone para comeÃ§ar.';
            }
        });

        document.querySelectorAll('.suggestion-item').forEach(item => {
            item.addEventListener('click', async () => {
                if (!apiKey) {
                    alert('Por favor, insira sua chave da API OpenAI primeiro!');
                    return;
                }
                const text = item.dataset.text;
                addMessage('user', text);
                await sendTextToGPT(text);
            });
        });

        recordBtn.addEventListener('click', async () => {
            if (!apiKey) {
                alert('Por favor, insira sua chave da API OpenAI primeiro! VocÃª pode obtÃª-la gratuitamente em platform.openai.com/api-keys');
                apiKeyInput.focus();
                return;
            }

            if (isRecording) {
                stopRecording();
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {echoCancellation: true, noiseSuppression: true, autoGainControl: true} 
                });
                
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/mp4'
                });
                
                audioChunks = [];
                isRecording = true;

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) audioChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    const mimeType = mediaRecorder.mimeType;
                    const audioBlob = new Blob(audioChunks, { type: mimeType });
                    stream.getTracks().forEach(track => track.stop());
                    await processAudio(audioBlob);
                };

                mediaRecorder.start();
                recordBtn.classList.add('recording');
                recordBtn.textContent = 'â¹ï¸';
                recordBtn.title = 'Parar gravaÃ§Ã£o';
                statusDiv.className = 'status recording';
                statusDiv.innerHTML = 'ðï¸ Gravando... Clique novamente para parar e enviar';

            } catch (error) {
                console.error('Erro ao acessar microfone:', error);
                isRecording = false;
                let errorMessage = 'Erro ao acessar o microfone. ';
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'PermissÃ£o negada. Por favor, permita o acesso ao microfone nas configuraÃ§Ãµes do navegador.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'Nenhum microfone encontrado. Verifique se hÃ¡ um microfone conectado.';
                } else {
                    errorMessage += 'Verifique as permissÃµes e tente novamente.';
                }
                alert(errorMessage);
                statusDiv.className = 'status';
                statusDiv.textContent = 'â Erro ao acessar microfone';
            }
        });

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.classList.remove('recording');
                recordBtn.textContent = 'ð¤';
                recordBtn.title = 'Iniciar gravaÃ§Ã£o de voz';
                statusDiv.className = 'status processing';
                statusDiv.innerHTML = 'â³ Processando Ã¡udio<span class="loading-dots"></span>';
            }
        }

        async function processAudio(audioBlob) {
            try {
                const formData = new FormData();
                const extension = audioBlob.type.includes('webm') ? 'webm' : 'mp4';
                formData.append('file', audioBlob, `audio.${extension}`);
                formData.append('model', 'whisper-1');
                formData.append('language', currentLanguage.split('-')[0]);

                statusDiv.className = 'status processing';
                statusDiv.innerHTML = 'ð§ Transcrevendo Ã¡udio<span class="loading-dots"></span>';

                const transcription = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: {'Authorization': `Bearer ${apiKey}`},
                    body: formData
                });

                if (!transcription.ok) {
                    const errorData = await transcription.json();
                    throw new Error(errorData.error?.message || 'Erro ao transcrever Ã¡udio');
                }

                const transcriptionData = await transcription.json();
                const userText = transcriptionData.text;

                if (!userText || userText.trim().length === 0) {
                    throw new Error('NÃ£o foi possÃ­vel detectar fala no Ã¡udio. Tente novamente falando mais claramente.');
                }

                addMessage('user', userText);
                await sendTextToGPT(userText);

            } catch (error) {
                console.error('Erro ao processar Ã¡udio:', error);
                statusDiv.className = 'status';
                statusDiv.innerHTML = `â Erro: ${error.message}`;
                recordBtn.disabled = false;
            }
        }

        async function sendTextToGPT(text) {
            try {
                statusDiv.className = 'status processing';
                statusDiv.innerHTML = 'ð¤ Pensando na resposta<span class="loading-dots"></span>';
                recordBtn.disabled = true;

                conversationHistory.push({role: 'user', content: text});

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {role: 'system', content: systemPrompts[currentLanguage]},
                            ...conversationHistory
                        ],
                        temperature: 0.8,
                        max_tokens: 600
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Erro ao comunicar com GPT');
                }

                const data = await response.json();
                const assistantText = data.choices[0].message.content;

                conversationHistory.push({role: 'assistant', content: assistantText});
                addMessage('assistant', assistantText);
                await textToSpeech(assistantText);

            } catch (error) {
                console.error('Erro ao comunicar com GPT:', error);
                statusDiv.className = 'status';
                statusDiv.innerHTML = `â Erro: ${error.message}`;
                recordBtn.disabled = false;
            }
        }

        async function textToSpeech(text) {
            try {
                statusDiv.className = 'status processing';
                statusDiv.innerHTML = 'ð Gerando resposta em Ã¡udio<span class="loading-dots"></span>';

                const voiceMap = {'pt-BR': 'alloy', 'en-US': 'echo', 'es-ES': 'nova'};

                const response = await fetch('https://api.openai.com/v1/audio/speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'tts-1',
                        voice: voiceMap[currentLanguage],
                        input: text,
                        speed: 1.0
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Erro ao gerar Ã¡udio');
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                currentAudio = new Audio(audioUrl);
                stopBtn.disabled = false;
                
                currentAudio.play();
                statusDiv.className = 'status';
                statusDiv.textContent = 'ð Reproduzindo resposta...';

                currentAudio.onended = () => {
                    statusDiv.className = 'status';
                    statusDiv.textContent = 'ð¬ Pronto para conversar! Clique no microfone.';
                    stopBtn.disabled = true;
                    recordBtn.disabled = false;
                };

            } catch (error) {
                console.error('Erro ao gerar Ã¡udio:', error);
                statusDiv.className = 'status';
                statusDiv.innerHTML = `â Erro ao gerar Ã¡udio: ${error.message}`;
                recordBtn.disabled = false;
            }
        }

        stopBtn.addEventListener('click', () => {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                statusDiv.className = 'status';
                statusDiv.textContent = 'â¹ï¸ ReproduÃ§Ã£o interrompida';
                stopBtn.disabled = true;
            }
        });

        function addMessage(type, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        addMessage('assistant', 'ð¬ OlÃ¡! Sou o CineTalk, seu assistente especializado em filmes e sÃ©ries! Fale sobre qualquer filme, sÃ©rie, diretor ou peÃ§a recomendaÃ§Ãµes. Estou aqui para conversar sobre cinema!');
    </script>
</body>
</html>
